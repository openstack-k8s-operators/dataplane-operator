apiVersion: dataplane.openstack.org/v1beta1
kind: OpenStackDataPlaneDeployment
metadata:
  name: openstack-edpm-ceph
spec:
  nodeSets:
    - openstack-edpm
  env:
    - name: ANSIBLE_FORCE_COLOR
      value: "True"
    - name: ANSIBLE_ENABLE_TASK_DEBUGGER
      value: "True"
    - name: ANSIBLE_ENABLE_TASK_DEBUGGER
      value: "True"
  # Create a nova-custom-ceph service which uses a ConfigMap
  # containing libvirt overrides for Ceph RBD.
  services:
   - configure-network
   - validate-network
   - install-os
   - configure-os
   - run-os
   - ceph-client
   - ovn
   - neutron-metadata
   - libvirt
   - nova-custom-ceph
  networkAttachments:
    - ctlplane
  # Create a secret called ceph-conf-files with the cephx key and
  # ceph.conf file and mount it so the ceph-client service can copy
  # those files to the EDPM nodes.
  extraMounts:
    - extraVolType: Logs
      mounts:
      - mountPath: /runner/artifacts
        name: ansible-logs
      volumes:
      - name: ansible-logs
        persistentVolumeClaim:
          claimName: ansible-ee-logs
    - extraVolType: Ceph
      mounts:
      - mountPath: /etc/ceph
        name: ceph
        readOnly: true
      volumes:
      - name: ceph
        projected:
          sources:
          - secret:
              name: ceph-conf-files
